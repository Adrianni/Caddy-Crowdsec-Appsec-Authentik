; =========================
; zz-hardening.ini (Docker)
; =========================

; Ikke avslør PHP i headers
expose_php = Off

; Ikke vis feil til klient (logg i stedet)
display_errors = Off
display_startup_errors = Off
html_errors = Off
log_errors = On
error_log = /proc/self/fd/2

; Strammere fil-resolving (reduserer pathinfo-baserte edge-caser)
cgi.fix_pathinfo = 0

; Sessions: mer robust mot session fixation + strammere cookies
session.use_strict_mode = 1
session.use_only_cookies = 1
session.use_trans_sid = 0
session.cookie_httponly = 1
session.cookie_secure = 1
session.cookie_samesite = Strict

; Litt hygiene
default_charset = "UTF-8"

; Anbefalt i prod (unngå at PHP prøver å gjette encoding i request)
; (kan stå tomt, men her settes konservativt)
variables_order = "GPCS"
request_order = "GP"

; Begrens hva PHP godtar av fil-extensions via FPM er allerede: .php .phar
; (FPM viser dette hos deg: security.limit_extensions)

; vurder etter testing
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,pcntl_exec
;
; ; --- Reduser informasjon i exceptions / stacktraces (nyttig selv om display_errors=Off) ---
zend.exception_ignore_args = 1
zend.exception_string_param_max_len = 0

; --- Unngå at PHP eksponerer argv/argc i web-kontekst ---
register_argc_argv = Off

; --- Skru av “remote include”-relaterte funksjoner ---
allow_url_include = Off
; allow_url_fopen kan knekke apper som bruker file_get_contents(https://...)
; hvis du kun bruker curl mot eksterne API-er, er Off ofte fint:
allow_url_fopen = Off

; (valgfritt) kortere levetid på sessions i prod – tilpass behov
; session.gc_maxlifetime = 3600

; --- Litt DOS-/ressurskontroll (kan også ligge i php.ini) ---
max_execution_time = 30
max_input_time = 30
memory_limit = 256M

; --- Filhåndtering / uploads (tilpass) ---
; file_uploads = On
; upload_max_filesize = 10M
; post_max_size = 12M

; Begrens filtilgang for PHP til kun webroot og midlertidige filer (reduserer skade ved LFI/path traversal)
open_basedir = /var/www:/tmp
